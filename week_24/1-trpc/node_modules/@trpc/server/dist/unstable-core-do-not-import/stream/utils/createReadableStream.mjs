import { createDeferred } from './createDeferred.mjs';

// ---------- utils
/**
 * One-off readable stream
 */ function createReadableStream() {
    let controller = null;
    const deferred = createDeferred();
    let cancelled = false;
    const readable = new ReadableStream({
        start (c) {
            controller = c;
        },
        cancel () {
            deferred.resolve('cancelled');
            cancelled = true;
        }
    });
    return {
        readable,
        controller,
        cancelledPromise: deferred.promise,
        cancelled () {
            return cancelled;
        }
    };
}

export { createReadableStream };
